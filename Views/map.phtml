<?php require ("Views/template/header.phtml"); ?>

    <!-- Load Leaflet HERE instead of waiting for footer -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        #map {
            width: 80%;
            height: 500px;
            margin: 50px auto;
            border: 2px solid #333;
            display: block;
        }
    </style>

    <div class="container">
        <div class="row">
            <div class="col-12 text-center">
                <p id="coordinates">Getting your location...</p>
                <p><?php echo $view->latitude; ?></p>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <div id="map"></div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                document.getElementById('coordinates').textContent =
                    `${lat.toFixed(6)}°, ${lng.toFixed(6)}°`;

                const map = L.map('map').setView([lat, lng], 15);

                setTimeout(function(){ map.invalidateSize()}, 400);

                L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(map);

                const locations = [
                    {lat: 53.488, lng: -2.274, title: "Location 1", description: "First marker"},
                    {lat: 53.490, lng: -2.276, title: "Location 2", description: "Second marker"},
                    {lat: 53.492, lng: -2.278, title: "Location 3", description: "Third marker"}
                ];

                locations.forEach(function(location) {
                    L.marker([location.lat, location.lng]).addTo(map)
                        .bindPopup(
                            '<div class="card" style="width: 18rem;">' +
                            '<img src="..." class="card-img-top" alt="...">' +
                            '<div class="card-body">' +
                            '<h5 class="card-title">Card title</h5>' +
                            '<p class="card-text">Some quick example text to build on the card title and make up the bulk of the card\'s content.</p>' +
                            '<a href="#" class="btn btn-primary">Go somewhere</a>' +
                            '</div>' +
                            '</div>'
                        );
                            });
            });
        }
    </script>

<?php require ("Views/template/footer.phtml"); ?>