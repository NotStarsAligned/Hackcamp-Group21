<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Measurements</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="my-style.css">
</head>
<body>

<?php require ("Views/template/header.phtml");?>

<div class="measurement-container">
    <div class="top-header-info">
        <div class="top-progress">
            <div class="progress-segment-1of5" style="background-color: #4CAF50;"></div>
            <div class="progress-segment-1of5" style="background-color: #F44336;"></div>
            <div class="progress-segment-1of5" style="background-color: #F44336;"></div>
            <div class="progress-segment-1of5" style="background-color: #F44336;"></div>
            <div class="progress-segment-1of5" style="background-color: #F44336;"></div>
        </div>
        <div class="d-flex justify-content-between p-2 pt-0 w-100" style="color: #444; font-size: 0.9rem;">
            <span>Measurements</span>
            <span>Page 1 of 5</span>
        </div>
    </div>

    <div class="container">
        <div class="toggle-unit d-flex justify-content-center align-items-center mb-4">
            <span>feet</span>
            <div class="form-check form-switch mx-3">
                <input class="form-check-input" type="checkbox" role="switch" id="unitToggle" checked>
                <label class="unit-toggle-switch" for="unitToggle"></label>
            </div>
            <span>metres</span>
        </div>

        <div class="input-layout-wrapper mx-auto" style="max-width: 600px;">
            <div class="row justify-content-center g-3">
                <div class="col-12 col-md-6 custom-input-box text-start">
                    <label for="inputLength" class="form-label d-block fw-bold" style="color: #0b0f3a;">Length:</label>
                    <input type="text" class="form-control" id="inputLength" placeholder="">
                </div>

                <div class="col-12 col-md-6 custom-input-box text-start">
                    <label for="inputWidth" class="form-label d-block fw-bold" style="color: #0b0f3a;">Width:</label>
                    <input type="text" class="form-control" id="inputWidth" placeholder="">
                </div>
            </div>
        </div>

        <div class="d-grid gap-2 col-6 mx-auto my-4">
            <button class="btn btn-primary fw-bold" type="button" id="calculateBtn">
                Calculate Area
            </button>
        </div>

        <div class="calc-value text-center fw-bold fs-5 text-success" id="calculatedAreaDisplay">
            &lt;Calculated Value&gt; m²/ft²
        </div>
    </div>

    <div class="d-flex justify-content-between w-100 position-fixed bottom-0 p-3 bg-white border-top">
        <a href="#" class="text-decoration-none fw-bold" style="color: #0b0f3a;">&lt;- Previous</a>

        <div class="page-indicator d-flex align-items-center">
            <div class="dot active"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>

        <a href="page2.php" class="text-decoration-none fw-bold" style="color: #0b0f3a;">Next -&gt;</a>
    </div>
</div>

<?php require ("Views/template/footer.phtml");?>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // =======================================================
    // 自动换算模型 (引用自 PHP 后端模型逻辑: 1 ft = 0.3048 m)
    // =======================================================
    const UnitConverter = {
        FEET_TO_METRES: 0.3048,

        // ft -> m
        toMetres: function(feet) {
            return feet * this.FEET_TO_METRES;
        },

        // m -> ft
        toFeet: function(metres) {
            return metres / this.FEET_TO_METRES;
        },

        // 确保数值有效，并保留两位小数
        formatValue: function(value) {
            const parsed = parseFloat(value);
            return isNaN(parsed) ? '' : parsed.toFixed(2);
        }
    };

    const lengthInput = document.getElementById('inputLength');
    const widthInput = document.getElementById('inputWidth');
    const unitToggle = document.getElementById('unitToggle');
    const calculateBtn = document.getElementById('calculateBtn');
    const display = document.getElementById('calculatedAreaDisplay');


    // 绑定单位切换事件：实现自动换算
    unitToggle.addEventListener('change', function() {
        const isMetres = unitToggle.checked; // true = metres, false = feet

        // 获取当前值
        let lengthValue = parseFloat(lengthInput.value);
        let widthValue = parseFloat(widthInput.value);

        if (isNaN(lengthValue) && isNaN(widthValue)) {
            // 如果两个输入框都是空的或无效的，则不进行换算
            calculateBtn.click(); // 触发计算以更新单位显示
            return;
        }

        // 仅在输入框有有效数值时进行换算
        if (!isNaN(lengthValue)) {
            let newValue;
            if (isMetres) {
                // 当前是 Feet，切换到 Metres (Feet -> Metres)
                newValue = UnitConverter.toMetres(lengthValue);
            } else {
                // 当前是 Metres，切换到 Feet (Metres -> Feet)
                newValue = UnitConverter.toFeet(lengthValue);
            }
            lengthInput.value = UnitConverter.formatValue(newValue);
        }

        if (!isNaN(widthValue)) {
            let newValue;
            if (isMetres) {
                // 当前是 Feet，切换到 Metres (Feet -> Metres)
                newValue = UnitConverter.toMetres(widthValue);
            } else {
                // 当前是 Metres，切换到 Feet (Metres -> Feet)
                newValue = UnitConverter.toFeet(widthValue);
            }
            widthInput.value = UnitConverter.formatValue(newValue);
        }

        // 切换单位后，重新计算面积并更新显示
        calculateBtn.click();
    });

    // 绑定计算按钮事件
    calculateBtn.addEventListener('click', function() {
        const length = parseFloat(lengthInput.value);
        const width = parseFloat(widthInput.value);
        const isMetres = unitToggle.checked;
        const unit = isMetres ? 'm²' : 'ft²';

        if (isNaN(length) || isNaN(width) || length <= 0 || width <= 0) {
            display.textContent = `Error: Please enter valid, positive Length and Width values. Current Unit: ${unit}`;
            display.classList.remove('text-success');
            display.classList.add('text-danger');
            return;
        }

        const area = length * width;

        display.textContent = `Calculated Area: ${area.toFixed(2)} ${unit}`;
        display.classList.remove('text-danger');
        display.classList.add('text-success');
    });
</script>
</body>
</html>